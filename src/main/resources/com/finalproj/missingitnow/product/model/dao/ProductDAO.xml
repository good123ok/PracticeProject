<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.finalproj.missingitnow.product.model.dao.ProductDAO">

	<resultMap id="ProductResultSet" type="ProductDTO">
		<id property="prodNo" column="PROD_NO"/>
		<result property="prodName" column="PROD_NAME"/>
		<result property="prodPrice" column="PROD_PRICE"/>
		<result property="prodDetails" column="PROD_DETAILS"/>
		<result property="prodUploadDate" column="PROD_UPLOAD_DATE"/>
		<result property="prodTerminateDate" column="PROD_TERMINATE_DATE"/>
		<result property="prodDiscountRate" column="PROD_DISCOUNT_RATE"/>
		<result property="prodDiscountPeriod" column="PROD_DISCOUNT_PERIOD"/>
		<result property="prodManufacturer" column="PROD_MANUFACTURER"/>
		<result property="stockQuantity" column="STOCK_QUANTITY"/>
		<result property="prodDisplayChk" column="PROD_DISPLAY_CHK"/>
		<result property="prodCtgNo" column="PROD_CTG_NO"/>
		<result property="corpNo" column="CORP_NO"/>
		<result property="prodHits" column="PROD_HITS"/>
		<result property="prodImgRename" column="PROD_IMG_RENAME"/>	
		<result property="prodImgPath" column="PROD_IMG_PATH"/>	
		<result property="corpName" column="CORP_NAME"/>	
	</resultMap>
	
	<resultMap id="CorpResultSet" type="CorpDTO">
		<id property="corpNo" column="CORP_NO"/>
		<result property="corpId" column="CORP_ID"/>
		<result property="corpPwd" column="CORP_PWD"/>
		<result property="corpName" column="CORP_NAME"/>
		<result property="corpContacts" column="CORP_CONTACTS"/>
		<result property="corpAddress" column="CORP_ADDRESS"/>
		<result property="corpEmail" column="CORP_EMAIL"/>
		<result property="corpRegistrationNo" column="CORP_REGISTRATION_NO"/>
		<result property="corpLvNo" column="CORP_LV_NO"/>
		<result property="corpCommisson" column="CORP_COMMISSION"/>
		<result property="depositAmt" column="DEPOSIT_AMT"/>
		<result property="corpRegstDate" column="CORP_REGST_DATE"/>
		<result property="corpRegstAccpeted" column="CORP_REGST_ACCPETED"/>
		<result property="corpLeaveChk" column="CORP_LEAVE_CHK"/>
	</resultMap>
	
	<resultMap id="ProductImgResultSet" type="ProductImgDTO">
		<id property="prodImgNo" column="PROD_IMG_NO"/>
		<result property="prodNo" column="PROD_NO"/>
		<result property="prodImgOriginName" column="PROD_IMG_ORIGIN_NAME"/>
		<result property="prodImgRename" column="PROD_IMG_RENAME"/>
		<result property="prodImgThnName" column="PROD_IMG_THN_NAME"/>
		<result property="prodImgPath" column="PROD_IMG_PATH"/>
		<result property="prodImgNumber" column="PROD_IMG_NUMBER"/>
	</resultMap>
	
	<resultMap id="ReviewResultSet" type="ReviewDTO">
		<id property="reviewNo" column="REVIEW_NO"/>
		<result property="prodNo" column="PROD_NO"/>
		<result property="userNo" column="USER_NO"/>
		<result property="reviewDetails" column="REVIEW_DETAILS"/>
		<result property="reviewScore" column="REVIEW_SCORE"/>
		<result property="reviewDate" column="REVIEW_DATE"/>
		<result property="nickname" column="USER_NAME"/>
	</resultMap>

	<select id="selectProduct" resultMap="ProductResultSet" parameterType="string">
		SELECT 
		       A.*
             , B.PROD_IMG_RENAME
             , B.PROD_IMG_PATH
             , c.CORP_NAME
		  FROM TBL_PRODUCT A
          JOIN TBL_PROD_IMG B ON (A.PROD_NO = B.PROD_NO)
          JOIN TBL_CORP_USER C ON (A.CORP_NO = C.CORP_NO)
		 WHERE A.PROD_CTG_NO = #{prodCtgNo}
		   AND B.PROD_IMG_THN_NAME = 'SUMNAME'
	</select>
	
	<select id="selectProductHigh" resultMap="ProductResultSet" parameterType="string">
		SELECT 
		       A.*
             , B.PROD_IMG_RENAME
             , B.PROD_IMG_PATH
             , c.CORP_NAME
		  FROM TBL_PRODUCT A
          JOIN TBL_PROD_IMG B ON (A.PROD_NO = B.PROD_NO)
          JOIN TBL_CORP_USER C ON (A.CORP_NO = C.CORP_NO)
		 WHERE A.PROD_CTG_NO = #{prodCtgNo}
		   AND B.PROD_IMG_THN_NAME = 'SUMNAME'
		 ORDER BY A.PROD_PRICE DESC
	</select>
	
	<select id="selectProductLow" resultMap="ProductResultSet" parameterType="string">
		SELECT 
		       A.*
             , B.PROD_IMG_RENAME
             , B.PROD_IMG_PATH
             , c.CORP_NAME
		  FROM TBL_PRODUCT A
          JOIN TBL_PROD_IMG B ON (A.PROD_NO = B.PROD_NO)
          JOIN TBL_CORP_USER C ON (A.CORP_NO = C.CORP_NO)
		 WHERE A.PROD_CTG_NO = #{prodCtgNo}
		   AND B.PROD_IMG_THN_NAME = 'SUMNAME'
		 ORDER BY A.PROD_PRICE
	</select>
	
	<select id="selectProductPopularity" resultMap="ProductResultSet" parameterType="string">
		SELECT 
		       A.*
             , B.PROD_IMG_RENAME
             , B.PROD_IMG_PATH
             , c.CORP_NAME
		  FROM TBL_PRODUCT A
          JOIN TBL_PROD_IMG B ON (A.PROD_NO = B.PROD_NO)
          JOIN TBL_CORP_USER C ON (A.CORP_NO = C.CORP_NO)
		 WHERE A.PROD_CTG_NO = #{prodCtgNo}
		   AND B.PROD_IMG_THN_NAME = 'SUMNAME'
		 ORDER BY A.PROD_HITS DESC
	</select>
	
	<select id="selectProductPriceChoice" resultMap="ProductResultSet" parameterType="hashmap">
		SELECT 
		       A.*
             , B.PROD_IMG_RENAME
             , B.PROD_IMG_PATH
             , c.CORP_NAME
		  FROM TBL_PRODUCT A
          JOIN TBL_PROD_IMG B ON (A.PROD_NO = B.PROD_NO)
          JOIN TBL_CORP_USER C ON (A.CORP_NO = C.CORP_NO)
		 WHERE A.PROD_CTG_NO = #{prodCtgNo}
           AND  A.PROD_PRICE BETWEEN  #{lowPrice} AND #{highPrice}
		   AND B.PROD_IMG_THN_NAME = 'SUMNAME'
	</select>
	
	<select id="product" resultMap="ProductResultSet" parameterType="string">
		SELECT 
		       A.*
             , B.PROD_IMG_RENAME
             , B.PROD_IMG_PATH
             , c.CORP_NAME
		  FROM TBL_PRODUCT A
          JOIN TBL_PROD_IMG B ON (A.PROD_NO = B.PROD_NO)
          JOIN TBL_CORP_USER C ON (A.CORP_NO = C.CORP_NO)
		 WHERE A.PROD_NO = #{prodNo}
	</select>
	
	<select id="corp" resultMap="CorpResultSet" parameterType="string">
		SELECT 
		       A.*
		  FROM TBL_CORP_USER A
		 WHERE A.CORP_NO = #{corpNo}
	</select>
	
	<select id="ProductImg" resultMap="ProductImgResultSet" parameterType="string">
		SELECT 
		       A.*
		  FROM TBL_PROD_IMG A
		 WHERE A.PROD_NO = #{prodNo}
	</select>
	
	<select id="review" resultMap="ReviewResultSet" parameterType="string">
		 SELECT 
		        A.*
              , B.USER_NAME
		   FROM TBL_PROD_REVIEW A
           JOIN TBL_USER B ON (A.USER_NO = B.USER_NO) 
		  WHERE A.PROD_NO = #{prodNo}
	</select>
	
 	 <select id="reviewStar" parameterType="hashmap">
		 INSERT 
		        INTO TBL_PROD_REVIEW
		 (
		   REVIEW_NO
		 , PROD_NO
		 , USER_NO
		 , REVIEW_DETAILS
		 , REVIEW_SCORE
		 , REVIEW_DATE
		 ) 
		 VALUES 
		 (
		   'REVW' || LPAD(SEQ_REVIEW.NEXTVAL,4,0)
		 , 'P06'
		 , 'USER0004'
		 , #{reviewList.reviewDetails}
		 , #{reviewList.stars}
		 , '2021-05-31'
		 )
	</select>

		
</mapper>











